<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CZL Chat-æŸ¥è¯¢OpenAIAPIä½™é¢</title>
  <meta name="description" content="æ‰¹é‡å¿«é€ŸæŸ¥è¯¢OPENAIçš„ä½™é¢ï¼Œæ”¯æŒå¯è§†åŒ–å±•ç°å·²ç”¨æ¯”ä¾‹ã€é¢åº¦ã€å·²ç”¨é‡ã€æœªç”¨é‡ã€æ˜¯å¦GPT-4ã€æ˜¯å¦ç»‘å¡">
  <style>
    :root {
      --color-primary: #1E3B7A;
      --color-primary-dark: #1E3B7A;
      --color-primary-alpha: #01847f;
      --body-color: #dadada;
      --body-bg: #000000;
      --border-color: #f8f8f800;
    }

    body {
      background: url('https://img.cdn.czl.net/i/2023/05/23/pjbczr.webp') no-repeat center center fixed;
      /* è‡ªå®šä¹‰èƒŒæ™¯å›¾ */
      background-size: cover;
      width: 90%;
      max-width: 980px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 2rem;
      padding-right: 2rem;
      color: var(--body-color);
      /* background: var(--body-bg); */
      font-family: system-ui, -apple-system, 'Segoe UI', Helvetica, Arial, sans-serif;
      line-height: 1.5;
      -webkit-tap-highlight-color: rgb(252, 247, 247);
      text-rendering: optimizelegibility;
      -webkit-font-smoothing: antialiased;
    }

    .query {
      max-width: 50rem;
      margin: auto;
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color .3s;
    }

    a:hover {
      color: var(--color-primary);
      text-decoration: underline;
    }

    h1 {
      font-size: 2.5rem;
      text-align: center;
    }

    main[x-cloak] {
      opacity: 0;
    }

    main:not([x-cloak]) {
      opacity: 1;
      transition: opacity .3s;
    }

    textarea {
      -webkit-appearance: none;
      appearance: none;
      display: block;
      width: 100%;
      padding: .5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: .25rem;
      box-sizing: border-box;
      color: #33404d;
      line-height: inherit;
      font-size: 1rem;
      transition: border .3s, box-shadow .3s;
    }

    textarea:focus {
      box-shadow: 0 0 0 .25rem var(--color-primary-alpha);
      border-color: var(--color-primary);
      outline: 0;
    }

    input {
      -webkit-appearance: none;
      appearance: none;
      display: block;
      width: 100%;
      padding: .5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: .25rem;
      box-sizing: border-box;
      color: #33404d;
      line-height: inherit;
      font-size: 1rem;
      transition: border .3s, box-shadow .3s;
    }

    input:focus {
      box-shadow: 0 0 0 .25rem var(--color-primary-alpha);
      border-color: var(--color-primary);
      outline: 0;
    }

    details {
      margin: 1rem 0 2rem;
      border: 1px solid var(--border-color);
      border-radius: .25rem;
      transition: background .3s;
    }

    details[open] {
      background: #fff;
    }

    details summary {
      padding: .5rem 1rem;
      font-weight: 500;
      user-select: none;
      cursor: pointer;
      opacity: .8;
      outline: 0;
    }

    details div {
      padding: 1rem;
      border-top: 1px solid var(--border-color);
    }

    details small {
      margin: 0;
      font-size: .875rem;
      line-height: 2;
    }

    button {
      appearance: none;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin: auto;
      max-width: 50rem;
      margin-bottom: 1rem;
      padding: .5rem .75rem;
      border: 1px solid var(--color-primary);
      border-radius: .25rem;
      background: var(--color-primary);
      color: #fff;
      font-size: 1rem;
      font-weight: 500;
      line-height: inherit;
      cursor: pointer;
      user-select: none;
      transition: border .3s, background .3s, ;
    }

    button:hover {
      border-color: var(--color-primary-dark);
      background: var(--color-primary-dark);
    }

    button:focus {
      box-shadow: 0 0 0 .25rem var(--color-primary-alpha);
      border-color: var(--color-primary);
      outline: 0;
    }

    button:disabled {
      background: var(--color-primary);
      border-color: var(--color-primary);
      opacity: .6;
      cursor: not-allowed;
    }

    button.loading::before {
      content: '';
      display: inline-block;
      margin-right: .5rem;
      border: 2px solid #fff;
      border-top-color: transparent;
      border-bottom-color: transparent;
      border-radius: 50%;
      width: .75rem;
      height: .75rem;
      animation: rotate .5s linear infinite;
    }

    footer {
      padding: 1rem;
      border-top: 1px solid var(--border-color);
      text-align: center;
      opacity: .5;
    }

    footer i {
      font-style: normal;
      color: #b32142;
    }

    .success,
    .error {
      margin-bottom: 1rem;
      padding: .5rem 1rem;
      border-radius: .25rem;
      color: #fff;
      text-align: center;
      opacity: 1;
      transition: opacity .3s;
    }

    .success {
      /* border: 1px solid #12b886; */
      background: #38d9a9;
    }

    .error {
      /* border: 1px solid #b32142; */
      background: #b32142;
    }

    @keyframes rotate {
      100% {
        transform: rotate(360deg);
      }
    }

    /* è®¾ç½®API URLé€‰æ‹©å™¨å’Œè‡ªå®šä¹‰URLè¾“å…¥æ¡†çš„æ ·å¼ */
    select#api-url-select,
    input#custom-url-input {
      width: 100%;
      height: 2.4rem;
      font-size: 1rem;
      background-color: #212121;
      margin-bottom: .5rem;
      padding: .5rem .75rem;
      color: #ffffff;
      border: none;
      padding: .5rem .75rem;
      border-radius: .25rem;
      margin-right: 10px;
      margin-top: 2vhpx;
      /* æ·»åŠ äº†é¡¶éƒ¨è¾¹è· */
    }



    /* éšè—è‡ªå®šä¹‰APIé“¾æ¥è¾“å…¥æ¡† */
    input#custom-url-input {
      display: none;
      height: 50px;
      /* æ·»åŠ é«˜åº¦ */
    }



    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼çš„æ ·å¼ */
    #result-table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
      overflow: hidden;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼è¡¨å¤´çš„æ ·å¼ */
    #result-table th {
      background-color: var(--color-primary);
      color: #ffffff;
      font-weight: 400;
      height: 20px;
      padding: 10px 25px;
      text-align: left;
      /* border: 1px solid #dcdcdc; */
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼æ•°æ®å•å…ƒæ ¼çš„æ ·å¼ */
    #result-table td {
      height: 20px;
      text-align: left;
      padding: 10px 25px;
      /* border: 1px solid #d3d3d3; */
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼å¥‡æ•°è¡Œçš„èƒŒæ™¯é¢œè‰² */
    #result-table tbody tr:nth-child(odd) {
      background-color: #252422;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼å¶æ•°è¡Œçš„èƒŒæ™¯é¢œè‰² */
    #result-table tbody tr:nth-child(even) {
      background-color: #31302d;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼è¡¨å¤´çš„å®½åº¦ */
    #result-table .table-header {
      width: 25%;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼æ•°æ®å•å…ƒæ ¼çš„å®½åº¦ã€å­—ä½“åŠ ç²—å’Œé¢œè‰² */
    #result-table .table-data {
      width: 25%;
      font-weight: bold;
      color: #1c248b;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ç»“æœè¡¨æ ¼æ•°æ®å•å…ƒæ ¼çš„æ ·å¼ */
    #result-table .status-error {
      height: 20px;
      text-align: center;
      padding: 10px 25px;
      /* border: 1px solid #dcdcdc; */
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªç±»åä¸ºstatus-okçš„æ ·å¼ï¼Œç”¨äºè®¾ç½®æˆåŠŸçŠ¶æ€çš„æ–‡æœ¬é¢œè‰² */
    .status-ok {
      color: #2d8d2d;
    }

    /* ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªç±»åä¸ºstatus-errorçš„æ ·å¼ï¼Œç”¨äºè®¾ç½®é”™è¯¯çŠ¶æ€çš„æ–‡æœ¬é¢œè‰² */
    .status-error {
      color: #ed0808;
    }

    #api-key-input {
      width: 100%;
      height: 100px;
      /* border: 1px solid #999; */
      background-color: #fff;
    }
  </style>
</head>

<body>
  <header>
    <h1 class="text-3xl font-semibold text-center mb-8 text-gradient">æŸ¥è¯¢ OpenAI API ä½™é¢</h1>
  </header>

  <div class="query">
    <div>
      <h2 style="display: inline-block;">è¾“å…¥ API KEY</h2>
      <p style="display: inline-block; font-size: smaller;">æœ¬ç«™ä¸ä¿å­˜ KEY ä¿¡æ¯ï¼ŒæŸ¥è¯¢åè¯·è‡ªè¡Œä¿å­˜</p>
    </div>
    <textarea id="api-key-input" placeholder="è¯·è¾“å…¥ API-KEYï¼Œå¿…é¡»åŒ…å« sk-,å¤šä¸ªå¯ç›´æ¥ç²˜è´´"></textarea></p>
    <!-- APIé“¾æ¥é€‰æ‹©æ¡† -->
    <div class="api-url-container"></div>
    <!-- APIé“¾æ¥é€‰æ‹© -->
    <div>
      <h2 style="display: inline-block;">é€‰æ‹©æŸ¥è¯¢çº¿è·¯</h2>
      <p style="display: inline-block; font-size: smaller;">æ”¯æŒè‡ªå®šä¹‰çº¿è·¯ï¼Œå®˜ç½‘çº¿è·¯éœ€è¦é­”æ³•</p>
    </div>
    <select id="api-url-select">
      <option value="https://api.openai.com">ã€å®˜ç½‘çº¿è·¯ã€‘api.openai.com</option>
      <option value="https://openaibilling.woodchen.ink">ã€CloudFlareã€‘openaibilling.woodchen.ink</option>
      <option value="custom">ã€å·²å‰ç½®httpsã€‘è‡ªå®šä¹‰ ...</option>
    </select>

    <!-- è‡ªå®šä¹‰APIé“¾æ¥è¾“å…¥æ¡† -->
    <input type="text" id="custom-url-input" placeholder="è¾“å…¥è‡ªå®šä¹‰APIï¼Œé»˜è®¤ä½¿ç”¨ https åè®®" />
  </div>
  <button :class="{ loading }" :disabled="loading" onclick="sendRequest()">æŸ¥è¯¢</button> </p>
  </div>
  <h2 id="result-head" style="visibility:hidden">æŸ¥è¯¢ç»“æœ</h2>
  <table id="result-table" style="visibility:hidden">
    <thead>
      <tr>
        <th>API KEY</th>
        <th style="width: 50px">æ€»é¢åº¦</th>
        <th style="width: 50px">å·²ä½¿ç”¨</th>
        <th style="width: 50px">å‰©ä½™é‡</th>
        <th style="width: 120px">å·²ç”¨æ¯”ä¾‹</th>
        <th style="width: 60px">åˆ°æœŸæ—¶é—´</th>
        <th style="width: 50px">GPT-4</th>
        <th style="width: 50px">ç»‘å¡</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <footer>
    <a href="https://chat.czl.net" style="color: white;" target="_blank">CZL Chat</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://store0.czl.net" style="color: white;" target="_blank">AI Store</a>

  </footer>


  <script>
    let queriedApiKeys = [];

    async function checkBilling(apiKey, apiUrl) {
      // è®¡ç®—èµ·å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ,å½“å‰ä¸º 90 å¤©ï¼Œæœ€å¤§ä¸è¶…è¿‡100å¤©
      const now = new Date();
      let startDate = new Date(now - 90 * 24 * 60 * 60 * 1000);
      const endDate = new Date(now.getTime() + 24 * 60 * 60 * 1000);
      const subDate = new Date(now);
      subDate.setDate(1);

      // è®¾ç½®APIè¯·æ±‚URLå’Œè¯·æ±‚å¤´
      const headers = {
        "Authorization": "Bearer " + apiKey,
        "Content-Type": "application/json"
      };
      const gpt4Check = `${apiUrl}/v1/models`;
      const urlSubscription = `${apiUrl}/v1/dashboard/billing/subscription`;
      let urlUsage = `${apiUrl}/v1/dashboard/billing/usage?start_date=${formatDate(startDate)}&end_date=${formatDate(endDate)}`;

      try {
        // è·å–APIé™é¢
        let response = await fetch(urlSubscription, { headers });
        if (!response.ok) {
          console.log("APIKEY é”™è¯¯æˆ–è´¦å·è¢«å°ï¼Œè¯·ç™»å½• OpenAI æŸ¥çœ‹ã€‚");
          return;
        }

        let currentDate = new Date();
        const subscriptionData = await response.json();
        const totalAmount = subscriptionData.system_hard_limit_usd;
        const expiryDate = new Date(subscriptionData.access_until * 1000 + 8 * 60 * 60 * 1000);
        const formattedDate = `${expiryDate.getFullYear()}-${(expiryDate.getMonth() + 1).toString().padStart(2, '0')}-${expiryDate.getDate().toString().padStart(2, '0')}`;

        const gpt4CheckResponse = await fetch(gpt4Check, { headers });
        const gpt4CheckData = await gpt4CheckResponse.json();
        let GPT4CheckResult = Array.isArray(gpt4CheckData.data) && gpt4CheckData.data.some(item => item.id.includes('gpt-4')) ? 'âœ…' : 'âŒ';
        let isSubscrible = subscriptionData.plan.id.includes('payg') ? 'ğŸŸ¢' : 'ğŸ”´';

        if (totalAmount > 20) {
          startDate = subDate;
          urlUsage = `${apiUrl}/v1/dashboard/billing/usage?start_date=${formatDate(startDate)}&end_date=${formatDate(endDate)}`;
          response = await fetch(urlUsage, { headers });
          const usageData = await response.json();
        }

        response = await fetch(urlUsage, { headers });
        const usageData = await response.json();
        const totalUsage = usageData.total_usage / 100;
        let remaining;
        if (currentDate > expiryDate) {
          remaining = "ğŸ”´è¿‡æœŸ";
        } else {
          remaining = subscriptionData.system_hard_limit_usd - totalUsage;
        }

        return [totalAmount, totalUsage, remaining, formattedDate, GPT4CheckResult, isSubscrible];
      } catch (error) {
        console.error(error);
        return ["Error", null, null, null, null, null];
      }
    }

    function formatDate(date) {
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');

      return `${year}-${month}-${day}`;
    }

    function sendRequest() {
      let apiKeyInput = document.getElementById("api-key-input");
      let apiUrlSelect = document.getElementById("api-url-select");
      let customUrlInput = document.getElementById("custom-url-input");
      let table = document.getElementById("result-table");
      let h2 = document.getElementById("result-head");
      h2.style.visibility = "visible";
      table.style.visibility = "visible";

      if (apiKeyInput.value.trim() === "") {
        alert("è¯·å¡«å†™API KEY");
        return;
      }

      document.getElementById("result-table").getElementsByTagName('tbody')[0].innerHTML = "";

      let apiUrl = "";
      if (apiUrlSelect.value === "custom") {
        if (customUrlInput.value.trim() === "") {
          alert("è¯·è®¾ç½®APIé“¾æ¥");
          return;
        } else {
          apiUrl = customUrlInput.value.trim();
          if (!apiUrl.startsWith("http://") && !apiUrl.startsWith("https://")) {
            apiUrl = "https://" + apiUrl;
          }
        }
      } else {
        apiUrl = apiUrlSelect.value;
      }

      let apiKeys = apiKeyInput.value.split(/[,\sï¼Œ\n]+/).filter(key => key.startsWith("sk-"));

      if (apiKeys.length === 0) {
        alert("æœªåŒ¹é…åˆ° API-KEYï¼Œè¯·æ£€æŸ¥è¾“å…¥å†…å®¹");
        return;
      }

      alert("æˆåŠŸåŒ¹é…åˆ° API Keyï¼Œç¡®è®¤åå¼€å§‹æŸ¥è¯¢ï¼š" + apiKeys);

      let tableBody = document.querySelector("#result-table tbody");
      for (let i = 0; i < apiKeys.length; i++) {
        let apiKey = apiKeys[i].trim();

        if (queriedApiKeys.includes(apiKey)) {
          console.log(`API KEY ${apiKey} å·²æŸ¥è¯¢è¿‡ï¼Œè·³è¿‡æ­¤æ¬¡æŸ¥è¯¢`);
          continue;
        }
        queriedApiKeys.push(apiKey);

        checkBilling(apiKey, apiUrl).then((data) => {
          let row = document.createElement("tr");

          let apiKeyCell = document.createElement("td");
          apiKeyCell.textContent = apiKey.replace(/^(sk-[a-zA-Z0-9]{4})[a-zA-Z0-9]*(.{6})$/, "$1***$2");
          row.appendChild(apiKeyCell);

          if (data[0] === "Error") {
            let errorMessageCell = document.createElement("td");
            errorMessageCell.colSpan = "5";
            errorMessageCell.classList.add("status-error");
            errorMessageCell.textContent = "ä¸æ­£ç¡®æˆ–å·²å¤±æ•ˆçš„API-KEY";
            row.appendChild(errorMessageCell);
          } else {
            let totalGrantedCell = document.createElement("td");
            totalGrantedCell.textContent = data[0].toFixed(2);
            row.appendChild(totalGrantedCell);

            let totalUsedCell = document.createElement("td");
            totalUsedCell.textContent = data[1].toFixed(2);
            row.appendChild(totalUsedCell);

            let totalAvailableCell = document.createElement("td");
            totalAvailableCell.textContent = typeof data[2] === 'number' ? data[2].toFixed(2) : data[2];
            row.appendChild(totalAvailableCell);

            // ä¿®æ”¹åçš„è¿›åº¦æ¡å•å…ƒæ ¼
            let progressCell = document.createElement("td");
            let progressContainer = document.createElement("div"); // æ·»åŠ ä¸€ä¸ªæ–°çš„å®¹å™¨å…ƒç´ 
            progressContainer.style.width = "100%";
            progressContainer.style.height = "20px";
            progressContainer.style.backgroundColor = "#f3f3f3"; // è®¾ç½®å®¹å™¨çš„èƒŒæ™¯è‰²ä¸ºç°ç™½è‰²

            let progressBar = document.createElement("div");
            progressBar.style.width = (data[1] / data[0] * 100).toFixed(2) + "%";
            progressBar.style.height = "20px";
            progressBar.style.backgroundColor = "#4CAF50";
            progressBar.style.position = "relative"; // è®¾ç½®è¿›åº¦æ¡çš„ position ä¸º relative
            progressBar.textContent = (data[1] / data[0] * 100).toFixed(2) + "%"; // æ˜¾ç¤ºç™¾åˆ†æ¯”
            progressBar.style.textAlign = "right"; // è®¾ç½®æ–‡æœ¬å¯¹é½æ–¹å¼ä¸ºå³å¯¹é½
            progressBar.style.paddingRight = "5px"; // è®¾ç½®å³è¾¹è·ä»¥ç¡®ä¿æ–‡æœ¬ä¸è¶…å‡ºè¾¹ç•Œ
            progressBar.style.color = "black"; // è®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºç™½è‰²

            progressContainer.appendChild(progressBar); // å°†è¿›åº¦æ¡æ·»åŠ åˆ°å®¹å™¨ä¸­
            progressCell.appendChild(progressContainer); // å°†å®¹å™¨æ·»åŠ åˆ°å•å…ƒæ ¼ä¸­
            row.appendChild(progressCell);


            let expireTime = document.createElement("td");
            expireTime.textContent = data[3];
            row.appendChild(expireTime);

            let GPT4CheckResult = document.createElement("td");
            GPT4CheckResult.textContent = data[4];
            row.appendChild(GPT4CheckResult);

            let isSubscribe = document.createElement("td");
            isSubscribe.textContent = data[5];
            row.appendChild(isSubscribe);
          }

          tableBody.appendChild(row);

          if (i === apiKeys.length - 1) {
            queriedApiKeys = [];
          }
          h2.style.display = 'block';
          table.style.display = 'table';

        }).catch((error) => {
          console.error(error);
          let row = document.createElement("tr");
          let apiKeyCell = document.createElement("td");
          apiKeyCell.textContent = apiKey;
          row.appendChild(apiKeyCell);

          let errorMessageCell = document.createElement("td");
          errorMessageCell.colSpan = "6";
          errorMessageCell.style.width = "90px";
          errorMessageCell.classList.add("status-error");
          errorMessageCell.textContent = "è´¦æˆ·ç–‘ä¼¼è¢«å°ç¦ï¼Œè¯·ç™»å½• OpenAI å®˜ç½‘ç¡®è®¤";
          row.appendChild(errorMessageCell);

          tableBody.appendChild(row);

          if (i === apiKeys.length - 1) {
            queriedApiKeys = [];
          }
        });
      }
    }

    let apiUrlSelect = document.getElementById("api-url-select");
    let customUrlInput = document.getElementById("custom-url-input");

    apiUrlSelect.addEventListener("change", function () {
      if (apiUrlSelect.value === "custom") {
        customUrlInput.style.display = "inline-block";
        customUrlInput.style.marginTop = "5px";
      } else {
        customUrlInput.style.display = "none";
      }
    });
  </script>

</body>

</html>